# 동기/비동기 컨텍스트 성능 비교 결과

테스트 일시: 2026-01-13 21:34:04
테스트 설정: Users=100, Spawn Rate=10, Run Time=2m

## ASGI에서 동기 함수 처리 방식

FastAPI/Starlette(ASGI)는 동기 함수(`def`)를 호출할 때 **ThreadPoolExecutor**를 사용합니다:

```python
# Starlette 내부 동작 (개념)
if asyncio.iscoroutinefunction(func):
    response = await func()  # 이벤트 루프에서 직접 실행
else:
    response = await run_in_executor(None, func)  # ThreadPool에서 실행
```

이로 인해:
- 동기 함수도 이벤트 루프를 **블로킹하지 않음**
- I/O가 없는 단순 응답에서는 동기/비동기 성능 차이가 **미미**
- 차이가 나는 경우: I/O 바운드 작업, 동시 요청 수가 스레드풀 크기 초과 시

## 테스트 환경 구성

| 케이스 | 인스턴스 수 | 워커 수 | 총 워커 |
|--------|------------|---------|---------|
| single_w1 | 1 | 1 | 1 |
| single_w4 | 1 | 4 | 4 |
| multi_w1 | 3 | 1 | 3 |
| multi_w4 | 3 | 4 | 12 |

## 테스트 결과 요약

### Simple Response Test (단순 응답)

| 케이스 | RPS | 평균 응답시간 (ms) | 중앙값 (ms) | 95% (ms) | 실패율 |
|--------|-----|-------------------|-------------|----------|--------|
| single_w1 | 309.9745674845521 | 10.325990847810145 | 2.173834000004149 | 7 | 0% |
| single_w4 | 310.6287960091341 | 7.653838747867867 | 2.153625000001824 | 6 | 0% |
| multi_w1 | N/A | N/A | N/A | N/A | N/A |
| multi_w4 | N/A | N/A | N/A | N/A | N/A |

### I/O Wait Test (I/O 대기)

| 케이스 | RPS | 평균 응답시간 (ms) | 중앙값 (ms) | 95% (ms) | 실패율 |
|--------|-----|-------------------|-------------|----------|--------|
| single_w1 | 2.1838689856887687 | 19356.95464760386 | 1042.364 | 21000 | 23.84% |
| single_w4 | 9.138902386864103 | 4790.881944977084 | 1008.790999999988 | 3800 | 0% |
| multi_w1 | N/A | N/A | N/A | N/A | N/A |
| multi_w4 | N/A | N/A | N/A | N/A | N/A |

## 분석 및 결론

### 예상 결과

1. **Simple Response**: 동기/비동기 차이 미미 (ThreadPoolExecutor 덕분)
2. **I/O Wait**: 비동기가 유리 (이벤트 루프 효율성)
3. **워커 증가**: RPS 증가, 응답시간 감소
4. **인스턴스 증가**: RPS 증가, 부하 분산 효과

### 최적 환경 선택 가이드

| 워크로드 유형 | 권장 설정 | 이유 |
|--------------|----------|------|
| CPU 바운드 | 워커 증가 | CPU 병렬 처리 활용 |
| I/O 바운드 | 비동기 + 인스턴스 증가 | 이벤트 루프 효율성 + 수평 확장 |
| 혼합 | 다중 인스턴스 + 적정 워커 | 균형잡힌 리소스 활용 |

---
결과 디렉토리: `/Users/sy/git_projects/FastAPI-Playground/performance_tests/results/comparison_20260113_211808`
